<pwa-step title="Install">
  <p>Install Angular CLI v6+:</p>

  <code-block lang="bsh"
              command="npm install --global @angular/cli@next"
              code="...
+ @angular/cli@6.0.0-rc.7
added 250 packages from 175 contributors in 9.11s"></code-block>



  <p class='notice'>
    Ignore the following <c-b code="npm install"></c-b> command as it is missing <c-b code="@next"></c-b>.
  </p>

  <node-package name="@angular/cli" global></node-package>

  <p>You should now have the Angular CLI installed.</p>

  <code-block lang="bsh"
              command="ng --version"
              code="
    _                      _                 ____ _     ___
   / \   _ __   __ _ _   _| | __ _ _ __     / ___| |   |_ _|
  / â–³ \ | '_ \ / _` | | | | |/ _` | '__|   | |   | |    | |
 / ___ \| | | | (_| | |_| | | (_| | |      | |___| |___ | |
/_/   \_\_| |_|\__, |\__,_|_|\__,_|_|       \____|_____|___|
               |___/


Angular CLI: 6.0.0-rc.7
Node: 10.0.0
OS: darwin x64
Angular:
...

Package                      Version
------------------------------------------------------
@angular-devkit/architect    0.5.10
@angular-devkit/core         0.5.10
@angular-devkit/schematics   0.5.10
@ngtools/json-schema         1.1.0
@schematics/angular          0.5.10
@schematics/update           0.5.10
rxjs                         6.0.0
typescript                   2.7.2"></code-block>
</pwa-step>

<pwa-step title="Generate">
  <p>Let's generate a new Angular app with the <c-b code="ng new"></c-b> command. The main argument we'll be needing right now is the name of the app.</p>

  <code-block lang="bsh"
              command="ng new awesome-sauce"
              code="CREATE awesome-sauce/README.md (1034 bytes)
CREATE awesome-sauce/angular.json (3884 bytes)
CREATE awesome-sauce/package.json (1397 bytes)
CREATE awesome-sauce/tsconfig.json (384 bytes)
CREATE awesome-sauce/tslint.json (2805 bytes)
CREATE awesome-sauce/.editorconfig (245 bytes)
CREATE awesome-sauce/.gitignore (503 bytes)
CREATE awesome-sauce/src/environments/environment.prod.ts (51 bytes)
CREATE awesome-sauce/src/environments/environment.ts (631 bytes)
CREATE awesome-sauce/src/favicon.ico (5430 bytes)
CREATE awesome-sauce/src/index.html (299 bytes)
CREATE awesome-sauce/src/main.ts (370 bytes)
CREATE awesome-sauce/src/polyfills.ts (3114 bytes)
CREATE awesome-sauce/src/test.ts (642 bytes)
CREATE awesome-sauce/src/assets/.gitkeep (0 bytes)
CREATE awesome-sauce/src/styles.css (80 bytes)
CREATE awesome-sauce/src/browserslist (375 bytes)
CREATE awesome-sauce/src/karma.conf.js (961 bytes)
CREATE awesome-sauce/src/tsconfig.app.json (194 bytes)
CREATE awesome-sauce/src/tsconfig.spec.json (282 bytes)
CREATE awesome-sauce/src/tslint.json (314 bytes)
CREATE awesome-sauce/src/app/app.module.ts (314 bytes)
CREATE awesome-sauce/src/app/app.component.css (0 bytes)
CREATE awesome-sauce/src/app/app.component.html (1141 bytes)
CREATE awesome-sauce/src/app/app.component.spec.ts (986 bytes)
CREATE awesome-sauce/src/app/app.component.ts (207 bytes)
CREATE awesome-sauce/e2e/protractor.conf.js (752 bytes)
CREATE awesome-sauce/e2e/src/app.e2e-spec.ts (299 bytes)
CREATE awesome-sauce/e2e/src/app.po.ts (208 bytes)
CREATE awesome-sauce/e2e/tsconfig.e2e.json (213 bytes)
...
added 1240 packages from 1266 contributors in 34.424s
    Successfully initialized git."></code-block>

  <p>That creates a new Angular app in the <c-b code="awesome-sauce"></c-b> directory from where we will do most of our work.</p>

  <code-block lang="bsh" command="cd awesome-sauce"></code-block>
</pwa-step>

<pwa-step title="Add PWA">
  <p>Now that we've got a shiny new Angular app, let's add a service worker using Angular's new <c-b code="ng add"></c-b> command. This will use a Schematic to add the needed packages and modify our code. <c-b code="--project"></c-b> takes the same app name we defined earlier.</p>

  <code-block lang="bsh"
              command="ng add @angular/pwa --project awesome-sauce"
              code="Installing packages for tooling via npm.
+ @angular/pwa@0.5.10
added 2 packages from 2 contributors in 7.962s
Installed packages for tooling via npm.
CREATE ngsw-config.json (392 bytes)
CREATE src/assets/icons/icon-128x128.png (1253 bytes)
CREATE src/assets/icons/icon-144x144.png (1394 bytes)
CREATE src/assets/icons/icon-152x152.png (1427 bytes)
CREATE src/assets/icons/icon-192x192.png (1790 bytes)
CREATE src/assets/icons/icon-384x384.png (3557 bytes)
CREATE src/assets/icons/icon-512x512.png (5008 bytes)
CREATE src/assets/icons/icon-72x72.png (792 bytes)
CREATE src/assets/icons/icon-96x96.png (958 bytes)
CREATE src/assets/manifest.json (1091 bytes)
UPDATE angular.json (3921 bytes)
UPDATE package.json (1443 bytes)
UPDATE src/app/app.module.ts (526 bytes)
UPDATE src/index.html (397 bytes)
added 1 package from 1 contributor and removed 2 packages in 8.275s"></code-block>

  <node-package name="@angular/pwa"></node-package>

  <p>If you have a look at the version control you can see several new and modified files.</p>

  <code-block lang="bsh"
              command="git status"
              code='On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   angular.json
        modified:   package-lock.json
        modified:   package.json
        modified:   src/app/app.module.ts
        modified:   src/index.html

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        ngsw-config.json
        src/assets/icons/
        src/assets/manifest.json

no changes added to commit (use "git add" and/or "git commit -a")'>
  </code-block>

  <mat-list role="list">
    <mat-list-item role="listitem">
      <c-b matLine code="ngsw-config.json"></c-b>
      <p matLine>tells the Angular CLI how to handle assets for caching.</p>
    </mat-list-item>
    <mat-list-item role="listitem">
      <c-b matLine code="icons"></c-b>
      <p matLine>will be your logo in various sizes</p>
    </mat-list-item>
    <mat-list-item role="listitem">
      <c-b matLine code="manifest.json"></c-b>
      <p matLine>describes your site and enables it to become installable.</p>
    </mat-list-item>
  </mat-list>

  <p>Let's also take a look at the changes to the existing files.</p>

  <code-block lang="bsh"
              command="git diff angular.json"
              code='diff --git a/angular.json b/angular.json
index 421874b..a1f84fc 100644
--- a/angular.json
+++ b/angular.json
@@ -51,7 +51,8 @@
               "aot": true,
               "extractLicenses": true,
               "vendorChunk": false,
-              "buildOptimizer": true
+              "buildOptimizer": true,
+              "serviceWorker": true
             }
           }
         },'></code-block>

  <p><c-b code="angular.json"></c-b> is the file used to configure the Angular CLI. Here we are telling it to build a service worker.</p>

  <code-block lang="bsh"
             command="git diff package.json"
             code='diff --git a/package.json b/package.json
index ca469fa..bb69a7c 100644
--- a/package.json
+++ b/package.json
@@ -23,7 +23,8 @@
     "@angular/router": "^6.0.0-rc.5",
     "core-js": "^2.5.4",
     "rxjs": "^6.0.0",
-    "zone.js": "^0.8.26"
+    "zone.js": "^0.8.26",
+    "@angular/service-worker": "^6.0.0-rc.5"
   },
   "devDependencies": {
     "@angular/compiler-cli": "^6.0.0-rc.5",'></code-block>

  <p><c-b code="package.json"></c-b> is including a new <c-b code="@angular/service-worker"></c-b> dependancy.</p>

  <code-block lang="bsh"
              command="git diff src/app/app.module.ts"
              code="diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index f657163..2f5db8d 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -2,13 +2,16 @@ import { BrowserModule } from '@angular/platform-browser';
 import { NgModule } from '@angular/core';

 import { AppComponent } from './app.component';
+import { ServiceWorkerModule } from '@angular/service-worker';
+import { environment } from '../environments/environment';

 @NgModule({
   declarations: [
     AppComponent
   ],
   imports: [
-    BrowserModule
+    BrowserModule,
+    ServiceWorkerModule.register('/ngsw-worker.js', { enabled: environment.production })
   ],
   providers: [],
   bootstrap: [AppComponent]"></code-block>

  <p>Here we see a new <c-b code="ServiceWorkerModule"></c-b> that's imported and is being told to register a service worker if the app is being built for production.</p>

  <code-block lang="bsh"
              command="git diff src/index.html"
              code='diff --git a/src/index.html b/src/index.html
index 75e1aff..eff255d 100644
--- a/src/index.html
+++ b/src/index.html
@@ -7,6 +7,8 @@

   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="icon" type="image/x-icon" href="favicon.ico">
+  <link rel="manifest" href="assets/manifest.json">
+  <meta name="theme-color" content="#1976d2">
 </head>
 <body>
   <app-root></app-root>'></code-block>

  <p>The last changed file we need to look it is <c-b code="index.html"></c-b>. With this change it tells browsers about the <c-b code="manifest.json"></c-b> file and sets a theme color.</p>

  <p>There are also two new JSON files and several new icon files.<p>

  <p>Let's look at <c-b code="ngsw-config.json"></c-b> first. This is the main file where you will configure how and when the Servivce Worker handles assets. We'll go into more details later.</p>

  <code-block lang="bsh"
              command="cat ngsw-config.json"
              code='{
  "index": "/index.html",
  "assetGroups": [{
    "name": "app",
    "installMode": "prefetch",
    "resources": {
      "files": [
        "/favicon.ico",
        "/index.html",
        "/*.css",
        "/*.js"
      ]
    }
  }, {
    "name": "assets",
    "installMode": "lazy",
    "updateMode": "prefetch",
    "resources": {
      "files": [
        "/assets/**"
      ]
    }
  }]
}'></code-block>

  <p>There are also a number of icons added. Currently they are just the Angular logo but you should replace them with your logo/brand.</p>

  <code-block lang="bsh"
              command="ls src/assets/icons"
              code="icon-128x128.png  icon-144x144.png  icon-152x152.png  icon-192x192.png  icon-384x384.png  icon-512x512.png  icon-72x72.png  icon-96x96.png"></code-block>

  <p>Finally there is <c-b code="manifest.json"></c-b>. Check out the <a [routerLink]="['/manifest']">Manifest page</a> for details.</p>
</pwa-step>

<pwa-step title="Commit">
  <p>It's a good idea to commit the changes to Git.</p>

  <code-block lang="bsh" command="git add ."></code-block>

  <code-block lang="bsh"
              command="git commit -m 'Make it so'"
              code="[master b7d1c19] Make it so
 15 files changed, 93 insertions(+), 3 deletions(-)
 create mode 100644 ngsw-config.json
 create mode 100644 src/assets/icons/icon-128x128.png
 create mode 100644 src/assets/icons/icon-144x144.png
 create mode 100644 src/assets/icons/icon-152x152.png
 create mode 100644 src/assets/icons/icon-192x192.png
 create mode 100644 src/assets/icons/icon-384x384.png
 create mode 100644 src/assets/icons/icon-512x512.png
 create mode 100644 src/assets/icons/icon-72x72.png
 create mode 100644 src/assets/icons/icon-96x96.png
 create mode 100644 src/assets/manifest.json"></code-block>
</pwa-step>

<pwa-step title="Run it">
  <p>As we saw earlier from <c-b code="app.module.ts"></c-b> the service worker only get's registered if we build the app in production mode. Angular CLI's server however <a href="https://github.com/angular/angular-cli/issues/9869" target="_blank" rel="noopener">doesn't support</a> service workers with --prod, so we'll have to use a different server. Typically we'd do that with something like this to build and server the app:</p>

  <code-block lang="bsh" command="npx ng build --prod && lite-server --baseDir dist/awesome-sauce"></code-block>

  <p>But when developing sites with service workers, you tend to run locally in production mode semi-frequently. So let's install <c-b code="lite-server"></c-b> as a devDependency and update the <c-b code="scripts"></c-b> value of <c-b code="package.json"></c-b> with helper script.</p>

  <code-block lang="bsh"
              command="npm install lite-server --save-dev"
              code="+ lite-server@2.3.0
added 96 packages from 125 contributors in 27.356s"></code-block>

  <node-package name="lite-server"></node-package>

  <p>Update <c-b code="package.json"></c-b> so that the <c-b code="scripts"></c-b> object has <c-b code="start:prod"></c-b>.</p>

  <code-block lang="bsh" code='{
  "ng": "ng",
  "start": "ng serve",
  "start:prod": "ng build --prod && lite-server --baseDir dist/awesome-sauce",
  "build": "ng build",
  "test": "ng test",
  "lint": "ng lint",
  "e2e": "ng e2e"
}'></code-block>

  <p>Now one command will rebuild the app in --prod mode and start the server. Keep in mind that if you make changes to the site you'll have to stop the server and start it again before seeing the changes.</p>

  <p><c-b code="--prod"></c-b> will tell the Angular CLI to build in production mode. This will perform additional optimizations to your CSS/JavaScript and most importantly will enable the service worker. <c-b code="--baseDir"></c-b> will tell <c-b code="lite-server"></c-b> where the built app should be served from.</p>

  <p>Don't forget to commit again.</p>

  <code-block lang="bsh" command="git add ."></code-block>

  <code-block lang="bsh" command="git commit -m 'Add lite-server and start:prod command'"></code-block>

  <code-block lang="bsh"
              command="npm run start:prod"
              code="...
Date: 2018-05-01T21:09:58.203Z
Hash: 9a6060b615702f574419
Time: 6681ms
chunk {0} runtime.6afe30102d8fe7337431.js (runtime) 1.05 kB [entry] [rendered]
chunk {1} styles.34c57ab7888ec1573f9c.css (styles) 0 bytes [initial] [rendered]
chunk {2} polyfills.2d976f42c1abc2acac30.js (polyfills) 59.4 kB [initial] [rendered]
chunk {3} main.f369b54424cf39b986c8.js (main) 164 kB [initial] [rendered]
Did not detect a `bs-config.json` or `bs-config.js` override file. Using lite-server defaults...
** browser-sync config **
{ injectChanges: false,
  files: [ './**/*.{html,htm,css,js}' ],
  watchOptions: { ignored: 'node_modules' },
  server:
   { baseDir: 'dist/awesome-sauce',
     middleware: [ [Function], [Function] ] } }
[Browsersync] Access URLs:
 --------------------------------------
       Local: http://localhost:3000
    External: http://192.168.200.8:3000
 --------------------------------------
          UI: http://localhost:3001
 UI External: http://192.168.200.8:3001
 --------------------------------------
[Browsersync] Serving files from: dist/awesome-sauce
[Browsersync] Watching files..."></code-block>

  <p><c-b code="http://localhost:3000"></c-b> should open in a browser automatically revealing this:</p>

  <img-2 [attr.width]="imgWidth" [attr.height]="imgHeight" src="/assets/images/http-server.png" alt="App running in a browser"></img-2>

  <p>Now open the Chrome DevTools to the Application tab and you should see a service worker installed from localhost.</p>

  <img-2 [attr.width]="imgWidth" [attr.height]="imgHeight" src="/assets/images/service-worker.png" alt="Installed service worker"></img-2>

  <p>Toggle the Network to "offline" and refesh. Everything will still render.</p>

  <img-2 [attr.width]="imgWidth" [attr.height]="imgHeight" src="/assets/images/offline.png" alt="App working offline"></img-2>

</pwa-step>
